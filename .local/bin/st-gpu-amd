#!/usr/bin/env zsh

# AMD GPU usage script - returns raw values: usage_percent memory_bytes temp_celsius

if ! command -v rocm-smi &> /dev/null; then
    echo "0 0 0"
    exit
fi

usage=$(rocm-smi -u | grep "GPU use" | awk '{print $6}' | sed 's/%//')
temp=$(rocm-smi | awk 'NR==8 {print $16}' | sed 's/C//')
vram_mb=$(rocm-smi --showmemuse | grep "GPU memory use" | awk '{print $6}' | sed 's/MB//')
vram_bytes=$((vram_mb * 1024 * 1024))

# Output raw values
echo "${usage:-0} ${vram_bytes:-0} ${temp:-0}"